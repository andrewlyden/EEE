

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Electricity market basics &#8212; Energy and Environmental Economics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Block3/electricity_market_basics';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Electricity grids" href="electricity_grids.html" />
    <link rel="prev" title="Environmental assessment" href="../Block2/environmental_assessment.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to Microeconomics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Block1/consumer_theory.html">Consumer Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Block1/producer_theory.html">Producer Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Block1/equilibrium.html">Equilibirum</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Environmental Economics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Block2/externalities.html">Externalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Block2/climate_negotiations.html">Climate negotiations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Block2/environmental_assessment.html">Environmental assessment</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Electricity Markets</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Electricity market basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="electricity_grids.html">Electricity grids</a></li>
<li class="toctree-l1"><a class="reference internal" href="electricity_investment.html">Investment in electricity markets</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/andrewlyden/EEE/blob/main/Block3/electricity_market_basics.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/andrewlyden/EEE" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/andrewlyden/EEE/issues/new?title=Issue%20on%20page%20%2FBlock3/electricity_market_basics.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Block3/electricity_market_basics.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Electricity market basics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#economic-dispatch">Economic dispatch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carbon-pricing">Carbon pricing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-time-periods">Multiple time periods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-storage">Energy storage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-for-great-britain">Example for Great Britain</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#including-technical-constraints">Including technical constraints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#markets-in-the-real-world">Markets in the real world</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="electricity-market-basics">
<h1>Electricity market basics<a class="headerlink" href="#electricity-market-basics" title="Permalink to this heading">#</a></h1>
<p>In this notebook, we will look at the basics of energy market operation. We will not yet consider energy networks, but instead look at an energy market located in a single point (so that we do not need to worry about any physical constraints on energy flows). NB: this notebook is heavy on computation, so it might take a while to load the examples.</p>
<p>This is not an electrical engineering course, so we will conveniently going to ignore very short-term operational problems (e.g., dynamics, and other things that happen in electrical systems on very short timescales of milliseconds to minutes); we will also ignore the intricacies of our modern alternating current networks. These are interesting but out of scope here. We will also confine ourselves to wholesale markets, where generators sell electricity to wholesale consumers (i.e., utilities and large industrial consumers). Utilities sell the power they buy on to consumers in consumer markets. These are less interesting from the perspective of energy market analysis, as consumers generally sign long-term contracts to buy electricity at a fixed price per unit, and competition depends more on marketing and service levels than on economics. You would expect, however, prices in consumer markets to be equal to a long-term average of wholesale market prices (as these represent the utility’s input costs), plus a markup to cover the utility’s other costs and profits, plus taxes. In the UK, consumer prices are approximately twice as high as wholesale market prices, but they do correlate over a number of years.</p>
<section id="economic-dispatch">
<h2>Economic dispatch<a class="headerlink" href="#economic-dispatch" title="Permalink to this heading">#</a></h2>
<p>The diagram below shows a simple example of four periods of energy market operation. Energy demand in the periods is assumed to be perfectly inelastic (i.e., not sensitive to prices), which is a reasonable approximation in the short term. Each period lasts 1 hour, such that, if a generator generates at 1MW in a particular period, it has generated 1MWh (i.e. MWs and MWhs are equivalent). Demand is given by</p>
<p>Period 1 1 MWh
Period 2 2 MWh
Period 3 3 MWh
Period 4 4 MWh</p>
<p>There are three types of generation. We have 2.1GW of coal-fired generation capacity, which has a constant marginal fuel cost of 8£/MWh and 2GW of gasfired generation a cost of 10£/MWh, while wind generation has no cost but a limited availability. Because of varying wind conditions, in each period, only the following percentage of its installed capacity is available:</p>
<p>Period 1 0 %
Period 2 0.5 %
Period 3 0.35 %
Period 4 0.9 %</p>
<p>You can choose the amount of installed wind capacity. In addition to their fuel costs, generators have to pay a carbon price if you select a nonzero value. Coal-fired generators emit 0.1t/MWh, and gas-fired generators 0.05t/MWh. Carbon prices are per tonne and due on all carbon the generators emit. Wind generators have no carbon emissions.</p>
<p>The widget below shows the optimal generation levels and prices which are obtained when we look for the intersection of the demand and supply curves in each period. This is also the perfectly competitive equilibrium, as we know that, without externalities or other distortions, perfect competition gives us the optimal quantities and prices. In mathematical terms, since there is no consumer surplus here (as the demand curve is vertical), we can obtain this point by minimising the total cost of generation (generation times variable generation costs, summed over all generators and all time periods), subject to a constraint that specifies that the sum of generation has to meet demand in each time period. Generation decisions are called dispatch decisions, so the generation levels correspond to optimal dispatch (or economic dispatch). The supply curve shows the merit order, i.e., the order in which generators should be dispatched in an optimal solution.</p>
<p>Experiment with the economic dispatch model below. Do you understand why prices are what they are (Note: they are the cost of the most expensive unit that is still producing, i.e. the price at the intersection of the supply and demand curves)? What happens to prices if we add progressively more wind into the system? Do you understand why? (this is called the merit order effect, because wind changes the supply curve). Would you be happy if you were one of the first to invest in wind turbines?</p>
<p>What happens if you increase carbon prices? Can you see coal and gas change place in the merit order? Do carbon emissions actually change if you increase the price? Why/why not?</p>
<p>If you had some energy storage capacity, when would you charge/discharge this? Would you be happy with more renewables or higher carbon prices, or not?</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># from jupyter_dash import JupyterDash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">Dash</span><span class="p">,</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">])</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="c1"># html.H4(&quot;Budget constraint&quot;),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select wind capacity:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-wind-capacity&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">250</span><span class="p">)},</span>
        <span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select wind availability:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-wind-availability&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>
        <span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select gas capacity:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-gas-capacity&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">250</span><span class="p">)},</span>
        <span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select coal capacity:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-coal-capacity&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">250</span><span class="p">)},</span>
        <span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select electricity demand:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-electricity-demand&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">4000</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4001</span><span class="p">,</span> <span class="mi">500</span><span class="p">)},</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-wind-capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-wind-availability&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-gas-capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-coal-capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-electricity-demand&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">wind_capacity</span><span class="p">,</span> <span class="n">wind_availability</span><span class="p">,</span> <span class="n">gas_capacity</span><span class="p">,</span> <span class="n">coal_capacity</span><span class="p">,</span> <span class="n">electricity_demand</span><span class="p">):</span>

    <span class="c1"># carbon emissions in tCO2/MWh</span>
    <span class="n">carbon_emissions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
    <span class="c1"># operational costs in £/MWh</span>
    <span class="n">operational_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
    <span class="c1"># marginal costs in £/MWh</span>
    <span class="n">carbon_price</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">marginal_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]}</span>
    <span class="c1"># power plant capacities (nominal powers in MW)</span>
    <span class="n">power_plant_p_nom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="n">coal_capacity</span><span class="p">,</span> <span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">wind_capacity</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="n">gas_capacity</span><span class="p">}}</span>
    <span class="c1"># country electrical loads in MW (not necessarily realistic)</span>
    <span class="n">loads</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Bus&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">electricity_demand</span><span class="p">]}</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
    <span class="c1"># snapshots labelled by [0,1,2,3]</span>
    <span class="n">country</span> <span class="o">=</span> <span class="s2">&quot;Bus&quot;</span>
    <span class="n">network</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>

    <span class="c1"># p_max_pu is variable for wind</span>
    <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">]:</span>
        <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">tech</span><span class="p">),</span>
            <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
            <span class="n">p_nom</span><span class="o">=</span><span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">marginal_cost</span><span class="o">=</span><span class="n">marginal_costs</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">p_max_pu</span><span class="o">=</span><span class="p">([</span><span class="n">wind_availability</span><span class="p">]</span> <span class="k">if</span> <span class="n">tech</span> <span class="o">==</span> <span class="s2">&quot;Wind&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># load which varies over the snapshots</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> load&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">),</span>
        <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
        <span class="n">p_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">electricity_demand</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">network</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;highs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">demand_supply_diagram</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>

        <span class="c1"># minimum marginal cost unit between gas and coal</span>
        <span class="n">marginal_costs_</span> <span class="o">=</span> <span class="n">marginal_costs</span>
        <span class="k">del</span> <span class="n">marginal_costs_</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span>
        <span class="n">min_type</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
        <span class="n">max_type</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">wind_capacity</span> <span class="o">*</span> <span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="s1">&#39;Bus Wind&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">min_type</span><span class="p">]</span>

        <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">min_type</span><span class="p">]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span>

        <span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">max_type</span><span class="p">]</span>

        <span class="n">x5</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">max_type</span><span class="p">]</span>
        <span class="n">y5</span> <span class="o">=</span> <span class="n">y4</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Add shapes</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">min_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y5</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">max_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_shapes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">xref</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">network</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Bus load&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">],</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom right&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">network</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">demand_supply_diagram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8062</span><span class="p">,</span> <span class="n">jupyter_height</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="900"
            src="http://127.0.0.1:8062/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="carbon-pricing">
<h2>Carbon pricing<a class="headerlink" href="#carbon-pricing" title="Permalink to this heading">#</a></h2>
<p>Spiel on carbon pricing.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># from jupyter_dash import JupyterDash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">Dash</span><span class="p">,</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">])</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="c1"># html.H4(&quot;Budget constraint&quot;),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select carbon price:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-carbon-price&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">8</span><span class="p">)},</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-carbon-price&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">carbon_price</span><span class="p">):</span>

    <span class="c1"># carbon emissions in tCO2/MWh</span>
    <span class="n">carbon_emissions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
    <span class="c1"># operational costs in £/MWh</span>
    <span class="n">operational_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
    <span class="c1"># marginal costs in £/MWh</span>
    <span class="n">marginal_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]}</span>
    <span class="c1"># power plant capacities (nominal powers in MW)</span>
    <span class="n">wind_capacity</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">power_plant_p_nom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}}</span>
    <span class="c1"># country electrical loads in MW (not necessarily realistic)</span>
    <span class="n">loads</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Bus&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2000</span><span class="p">]}</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
    <span class="c1"># snapshots labelled by [0,1,2,3]</span>
    <span class="n">country</span> <span class="o">=</span> <span class="s2">&quot;Bus&quot;</span>
    <span class="n">network</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>

    <span class="c1"># p_max_pu is variable for wind</span>
    <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">]:</span>
        <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">tech</span><span class="p">),</span>
            <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
            <span class="n">p_nom</span><span class="o">=</span><span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">marginal_cost</span><span class="o">=</span><span class="n">marginal_costs</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">p_max_pu</span><span class="o">=</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]</span> <span class="k">if</span> <span class="n">tech</span> <span class="o">==</span> <span class="s2">&quot;Wind&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># load which varies over the snapshots</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> load&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">),</span>
        <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
        <span class="n">p_set</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2000</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">network</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;highs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">demand_supply_diagram</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>

        <span class="c1"># minimum marginal cost unit between gas and coal</span>
        <span class="n">marginal_costs_</span> <span class="o">=</span> <span class="n">marginal_costs</span>
        <span class="k">del</span> <span class="n">marginal_costs_</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span>
        <span class="n">min_type</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
        <span class="n">max_type</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">wind_capacity</span> <span class="o">*</span> <span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="s1">&#39;Bus Wind&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">min_type</span><span class="p">]</span>

        <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">min_type</span><span class="p">]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span>

        <span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">max_type</span><span class="p">]</span>

        <span class="n">x5</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">max_type</span><span class="p">]</span>
        <span class="n">y5</span> <span class="o">=</span> <span class="n">y4</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Add shapes</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">min_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y5</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">max_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_shapes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">xref</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">network</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Bus load&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">],</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom right&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">network</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">demand_supply_diagram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

<span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8063</span><span class="p">,</span> <span class="n">jupyter_height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="600"
            src="http://127.0.0.1:8063/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="multiple-time-periods">
<h2>Multiple time periods<a class="headerlink" href="#multiple-time-periods" title="Permalink to this heading">#</a></h2>
<p>apply above for multiple time periods…</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># from jupyter_dash import JupyterDash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">Dash</span><span class="p">,</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>

<span class="n">wind_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,))</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">])</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="c1"># html.H4(&quot;Budget constraint&quot;),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph2&quot;</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select period:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-period&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph2&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-period&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>

    <span class="c1"># carbon emissions in tCO2/MWh</span>
    <span class="n">carbon_emissions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
    <span class="c1"># operational costs in £/MWh</span>
    <span class="n">operational_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
    <span class="c1"># marginal costs in £/MWh</span>
    <span class="n">carbon_price</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">marginal_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]}</span>
    <span class="c1"># power plant capacities (nominal powers in MW)</span>
    <span class="n">wind_capacity</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">power_plant_p_nom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">wind_capacity</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">}}</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
    <span class="c1"># snapshots labelled by [0,1,2,3]</span>
    <span class="n">country</span> <span class="o">=</span> <span class="s2">&quot;Bus&quot;</span>
    <span class="n">network</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>

    <span class="c1"># p_max_pu is variable for wind</span>
    <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">]:</span>
        <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">,</span> <span class="n">tech</span><span class="p">),</span>
            <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
            <span class="n">p_nom</span><span class="o">=</span><span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">marginal_cost</span><span class="o">=</span><span class="n">marginal_costs</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">p_max_pu</span><span class="o">=</span><span class="p">(</span><span class="n">wind_profile</span><span class="p">)</span> <span class="k">if</span> <span class="n">tech</span> <span class="o">==</span> <span class="s2">&quot;Wind&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># load which varies over the snapshots</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> load&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">),</span>
        <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
        <span class="n">p_set</span><span class="o">=</span><span class="p">[</span><span class="mi">1500</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">network</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;highs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">demand_supply_diagram</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>

        <span class="c1"># minimum marginal cost unit between gas and coal</span>
        <span class="n">marginal_costs_</span> <span class="o">=</span> <span class="n">marginal_costs</span>
        <span class="k">del</span> <span class="n">marginal_costs_</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span>
        <span class="n">min_type</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
        <span class="n">max_type</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">wind_capacity</span> <span class="o">*</span> <span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="s1">&#39;Bus Wind&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">min_type</span><span class="p">]</span>

        <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">min_type</span><span class="p">]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span>

        <span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">max_type</span><span class="p">]</span>

        <span class="n">x5</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">max_type</span><span class="p">]</span>
        <span class="n">y5</span> <span class="o">=</span> <span class="n">y4</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Add shapes</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">min_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y5</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">max_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_shapes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">xref</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">network</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Bus load&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">],</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom right&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">network</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fig</span>
    
    <span class="k">def</span> <span class="nf">generation_fig</span><span class="p">():</span>
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="p">)</span><span class="c1">#, facet_col=[&#39;Bus Coal&#39;, &#39;Bus Wind&#39;, &#39;Bus Gas&#39;], facet_col_wrap=3, facet_row_spacing=0.05, facet_col_spacing=0.05)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Power (MW)&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Period&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    
            <span class="k">return</span> <span class="n">fig</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">demand_supply_diagram</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">generation_fig</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">fig2</span>

<span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8064</span><span class="p">,</span> <span class="n">jupyter_height</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="1000"
            src="http://127.0.0.1:8064/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="energy-storage">
<h2>Energy storage<a class="headerlink" href="#energy-storage" title="Permalink to this heading">#</a></h2>
<p>Energy storage and how it impacts here…</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pypsa</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># from jupyter_dash import JupyterDash</span>
<span class="kn">from</span> <span class="nn">dash</span> <span class="kn">import</span> <span class="n">Dash</span><span class="p">,</span> <span class="n">dcc</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Output</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">dash_bootstrap_components</span> <span class="k">as</span> <span class="nn">dbc</span>

<span class="n">wind_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,))</span>
<span class="c1"># load_profile = np.random.uniform(low=1000, high=1500, size=(24,))</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Dash</span><span class="p">(</span><span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">dbc</span><span class="o">.</span><span class="n">themes</span><span class="o">.</span><span class="n">BOOTSTRAP</span><span class="p">])</span>

<span class="n">app</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Div</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="c1"># html.H4(&quot;Budget constraint&quot;),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;graph2&quot;</span><span class="p">),</span>
        <span class="n">html</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="s2">&quot;Select period:&quot;</span><span class="p">),</span>
        <span class="n">dcc</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;slider-period&quot;</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">marks</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Output</span><span class="p">(</span><span class="s2">&quot;graph2&quot;</span><span class="p">,</span> <span class="s2">&quot;figure&quot;</span><span class="p">),</span>
    <span class="n">Input</span><span class="p">(</span><span class="s2">&quot;slider-period&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>

    <span class="c1"># carbon emissions in tCO2/MWh</span>
    <span class="n">carbon_emissions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">}</span>
    <span class="c1"># operational costs in £/MWh</span>
    <span class="n">operational_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
    <span class="c1"># marginal costs in £/MWh</span>
    <span class="n">carbon_price</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">marginal_costs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Coal&#39;</span><span class="p">],</span>
                    <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="n">carbon_emissions</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">carbon_price</span> <span class="o">+</span> <span class="n">operational_costs</span><span class="p">[</span><span class="s1">&#39;Gas&#39;</span><span class="p">]}</span>
    <span class="c1"># power plant capacities (nominal powers in MW)</span>
    <span class="n">wind_capacity</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="n">power_plant_p_nom</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Bus&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Wind&quot;</span><span class="p">:</span> <span class="n">wind_capacity</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;Coal&quot;</span><span class="p">:</span> <span class="mi">4000</span><span class="p">}}</span>

    <span class="n">network</span> <span class="o">=</span> <span class="n">pypsa</span><span class="o">.</span><span class="n">Network</span><span class="p">()</span>
    <span class="c1"># snapshots labelled by [0,1,2,3]</span>
    <span class="n">country</span> <span class="o">=</span> <span class="s2">&quot;Bus&quot;</span>
    <span class="n">network</span><span class="o">.</span><span class="n">set_snapshots</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>

    <span class="c1"># p_max_pu is variable for wind</span>
    <span class="k">for</span> <span class="n">tech</span> <span class="ow">in</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">]:</span>
        <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="s2">&quot;Generator&quot;</span><span class="p">,</span>
            <span class="n">tech</span><span class="p">,</span>
            <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
            <span class="n">p_nom</span><span class="o">=</span><span class="n">power_plant_p_nom</span><span class="p">[</span><span class="n">country</span><span class="p">][</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">marginal_cost</span><span class="o">=</span><span class="n">marginal_costs</span><span class="p">[</span><span class="n">tech</span><span class="p">],</span>
            <span class="n">p_max_pu</span><span class="o">=</span><span class="p">(</span><span class="n">wind_profile</span><span class="p">)</span> <span class="k">if</span> <span class="n">tech</span> <span class="o">==</span> <span class="s2">&quot;Wind&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># load which varies over the snapshots</span>
    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;Load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> load&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">country</span><span class="p">),</span>
        <span class="n">bus</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
        <span class="n">p_set</span><span class="o">=</span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="s2">&quot;StorageUnit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Storage&quot;</span><span class="p">,</span>
        <span class="n">bus</span><span class="o">=</span><span class="s2">&quot;Bus&quot;</span><span class="p">,</span>
        <span class="n">marginal_cost</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">inflow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">p_nom_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">capital_cost</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">p_nom</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">efficiency_dispatch</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">cyclic_state_of_charge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">state_of_charge_initial</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>


    <span class="n">network</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="s1">&#39;highs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">demand_supply_diagram</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>

        <span class="c1"># minimum marginal cost unit between gas and coal</span>
        <span class="n">marginal_costs_</span> <span class="o">=</span> <span class="n">marginal_costs</span>
        <span class="k">del</span> <span class="n">marginal_costs_</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">]</span>
        <span class="n">min_type</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
        <span class="n">max_type</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">marginal_costs_</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">marginal_costs_</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

        <span class="n">x0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">wind_capacity</span> <span class="o">*</span> <span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p_max_pu</span><span class="p">[</span><span class="s1">&#39;Wind&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">min_type</span><span class="p">]</span>

        <span class="n">x3</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">min_type</span><span class="p">]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span>

        <span class="n">x4</span> <span class="o">=</span> <span class="n">x3</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">marginal_costs</span><span class="p">[</span><span class="n">max_type</span><span class="p">]</span>

        <span class="n">x5</span> <span class="o">=</span> <span class="n">x4</span> <span class="o">+</span> <span class="n">power_plant_p_nom</span><span class="p">[</span><span class="s1">&#39;Bus&#39;</span><span class="p">][</span><span class="n">max_type</span><span class="p">]</span>
        <span class="n">y5</span> <span class="o">=</span> <span class="n">y4</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Add shapes</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">min_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">y4</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y5</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;RoyalBlue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">max_type</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;consumer_surplus_text&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_shapes</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">xref</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">))</span>


        <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">network</span><span class="o">.</span><span class="n">loads_t</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Bus load&#39;</span><span class="p">][</span><span class="n">period</span><span class="p">],</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="n">annotation_position</span><span class="o">=</span><span class="s2">&quot;bottom right&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">network</span><span class="o">.</span><span class="n">generators</span><span class="o">.</span><span class="n">p_nom</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">title_text</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span>
        

        <span class="k">return</span> <span class="n">fig</span>
    
    <span class="k">def</span> <span class="nf">generation_fig</span><span class="p">():</span>
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">generators_t</span><span class="o">.</span><span class="n">p</span><span class="p">)</span><span class="c1">#, facet_col=[&#39;Bus Coal&#39;, &#39;Bus Wind&#39;, &#39;Bus Gas&#39;], facet_col_wrap=3, facet_row_spacing=0.05, facet_col_spacing=0.05)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">matches</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Power (MW)&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Period&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

            <span class="n">fig_storage</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">storage_units_t</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
            <span class="n">fig_storage</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">)</span>
            <span class="n">fig_storage</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">fig_storage</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="p">)</span>
    
            <span class="k">return</span> <span class="n">fig</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">demand_supply_diagram</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">generation_fig</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">fig2</span>

<span class="n">app</span><span class="o">.</span><span class="n">run_server</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8065</span><span class="p">,</span> <span class="n">jupyter_height</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="100%"
            height="1000"
            src="http://127.0.0.1:8065/"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.03s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 72 primals, 168 duals
Objective: 1.88e+05
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.07s
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.io: Writing time: 0.07s
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 72 primals, 168 duals
Objective: 1.88e+05
Solver model: available
Solver message: optimal

INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.io: Writing time: 0.05s
INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 3 primals, 7 duals
Objective: 5.31e+03
Solver model: available
Solver message: optimal

INFO:linopy.io: Writing time: 0.05s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 3 primals, 7 duals
Objective: 1.45e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.04s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.03s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.03s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.04s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.03s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.01s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 3 primals, 7 duals
Objective: 1.45e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.02s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 3 primals, 7 duals
Objective: 5.31e+03
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.03s
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.io: Writing time: 0.04s
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 3 primals, 7 duals
Objective: 5.31e+03
Solver model: available
Solver message: optimal

INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.io: Writing time: 0.11s
INFO:linopy.io: Writing time: 0.05s
INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 3 primals, 7 duals
Objective: 1.45e+04
Solver model: available
Solver message: optimal

INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 144 primals, 336 duals
Objective: 4.55e+04
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 72 primals, 168 duals
Objective: 1.88e+05
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper, StorageUnit-fix-p_dispatch-lower, StorageUnit-fix-p_dispatch-upper, StorageUnit-fix-p_store-lower, StorageUnit-fix-p_store-upper, StorageUnit-fix-state_of_charge-lower, StorageUnit-fix-state_of_charge-upper, StorageUnit-energy_balance were not assigned to the network.
INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.01s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 72 primals, 168 duals
Objective: 1.88e+05
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.01s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 72 primals, 168 duals
Objective: 1.88e+05
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
INFO:linopy.model: Solve problem using Highs solver
INFO:linopy.io: Writing time: 0.01s
INFO:linopy.solvers:Log file at C:\Users\alyden\AppData\Local\Temp\highs.log.
INFO:linopy.constants: Optimization successful: 
Status: ok
Termination condition: optimal
Solution: 72 primals, 168 duals
Objective: 1.88e+05
Solver model: available
Solver message: optimal

INFO:pypsa.optimization.optimize:The shadow-prices of the constraints Generator-fix-p-lower, Generator-fix-p-upper were not assigned to the network.
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-for-great-britain">
<h2>Example for Great Britain<a class="headerlink" href="#example-for-great-britain" title="Permalink to this heading">#</a></h2>
<p><img alt="GB" src="../_images/2016_generation_dispatch.png" /></p>
</section>
<section id="including-technical-constraints">
<h2>Including technical constraints<a class="headerlink" href="#including-technical-constraints" title="Permalink to this heading">#</a></h2>
<p>The example above assumed that you could dispatch each generator at any level between 0 and its capacity. In reality, this is not the case. Conventional generators (coal, gas, etc.), in particular, generally have many constraints on their operations. Once important constraint is that they generally cannot increase or decrease their production very quickly - it takes time to make large adjustments to output, similarly to how a car cannot go from 0 to 200mph instantaneously. These constraints are called ramping constraints. They limit the amount of generation possible in a particular period to be within a given range of the generation in the previous period. Generators that are very flexible (e.g., newer gas-fired generators) can ramp quickly. Generators that are inflexible (e.g. especially older nuclear power plants) cannot ramp quickly.</p>
<p>In addition to ramping constraints, conventional generators generally have minimum run levels. They cannot produce a positive amount below these levels. A 1GW generator might, for instance have a minimum run level of 50%, which means that it can only either generate nothing, or generate between 0.5 and 1GW. Generators therefore do not only decide how much to generate, but also whether they will generate at all. To make this more complicated, it generally takes time to start up a generator, so if a generator is turned off, it may not be able to generate anything in the immediate future. Generators might also have minimum up and down times, such that when they turn off they have to remain off for a number of periods, and when they are on, they have to remain on for a number of time periods. Decisions about being on or off are called unit commitment decisions. They are binary - units are either on (“online”) or off (“offline”). Economic dispatch problems with unit commitment constraints are sometimes called unit commitment problems.</p>
</section>
<section id="markets-in-the-real-world">
<h2>Markets in the real world<a class="headerlink" href="#markets-in-the-real-world" title="Permalink to this heading">#</a></h2>
<p>The above models are representations of markets. In the real world, depending on the type of market (as we will see next week), there might be a market operator which on a regular (e.g., hourly) basis solves problems similar to those above, but with many more generators and time periods, and generally using bids that generators/consumers have declared instead of their actual costs and benefits. This market operator then instructs the generators and consumers what to do in every period, with penalties for deviating from these instruction. In other markets, such as the UK, there is no centralised dispatch - generators make their own decisions. However, if we assume perfect competition, we would get to the same solution, so large-scale versions of the
models above can still be used by industry or by researchers to predict what will happen.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Block3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../Block2/environmental_assessment.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Environmental assessment</p>
      </div>
    </a>
    <a class="right-next"
       href="electricity_grids.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Electricity grids</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#economic-dispatch">Economic dispatch</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#carbon-pricing">Carbon pricing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-time-periods">Multiple time periods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-storage">Energy storage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-for-great-britain">Example for Great Britain</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#including-technical-constraints">Including technical constraints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#markets-in-the-real-world">Markets in the real world</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Andrew Lyden
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>